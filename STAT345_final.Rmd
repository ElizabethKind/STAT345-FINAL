---
title: "Group 1: Monopoly"
output: word_document
date: "2025-04-11"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Section One
```{r}
# Word docx in repository
```


## Section Two
```{r}
dice_1 <- function() {
  sample(1:6, 1) #randomly choose one number from 1-6
}

dice_2 <- function() {
  sample(1:6, 1) #randomly choose one number from 1-6
}

property_sum_10games <- c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)

#simulate 10 games
for (game in 1:10) {
  #initialize game board with 41 spaces that all start with 0 times they have been landed on
  game_board <- c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)

  #list of players
  players <- list(
    #initialize player positions (all start at position 0)
    player1 <- 0,
    player2 <- 0,
    player3 <- 0,
    player4 <- 0
  )

  #simulate 50 turns per player (200 turns in each game)
  for (i in 1:50) {
    for (j in 1:4) {
      dice_total <- dice_1() + dice_2() #rolling dice
      players[[j]] <- (players[[j]] + dice_total) %% 41 #move player forward by dice_total amount repeating around board using %% 41
      game_board[players[[j]]] <- game_board[players[[j]]] + 1 #add one for the count for the space the player just moved to
    }
  }

  #select only the indices on the board that correspond to properties
  properties <- game_board[c(2, 4, 6, 7, 9, 10, 12, 13, 14, 15, 16, 17, 19, 20, 22, 24, 25, 26, 27, 28, 29, 30, 32, 33, 35, 36, 38, 40)]

  #collect landing frequencies for 10 games
  property_sum_10games <- property_sum_10games + properties
}  

#assign names to properties
names(property_sum_10games) <- c("Mediterranean Avenue", "Baltic Avenue", "Reading Railroad", "Oriental Avenue", "Vermont Avenue", "Connecticut Avenue", "St. Charles Place", "Electric Company", "States Avenue", "Virginia Avenue", "Pennsylvania Railroad", "St. James Place", "Tennessee Avenue", "New York Avenue", "Kentucky Avenue", "Indiana Avenue", "Illinois Avenue", "B&O Railroad", "Atlantic Avenue", "Ventnor Avenue", "Water Works", "Marvin Gardens", "Pacific Avenue", "North Carolina Avenue", "Pennsylvania Avenue", "Short Line", "Park Place", "Boardwalk")

library(ggplot2)

#data frame with property names and their frequencies
prop_freq1 <- data.frame(
  property = factor(names(property_sum_10games), levels = names(property_sum_10games)),
  frequency = property_sum_10games
)

#plot frequencies in a bar chart
ggplot(prop_freq1, aes(x = property, y = frequency)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(x = "Index", y = "Frequency", title = "Bar Plot of Property Frequencies") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Section Three
```{r}
property_sum_10games_jail <- c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)

for (game in 1:10) {
  game_board <- c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)

  players <- list( # Store players as a list of data frames with their information
    player1 <- data.frame(
      location = 0, # Location on the board (integer)
      double_rolls = 0, # Number of times doubles have been rolled consecutively (integer)
      jail = FALSE, # Is the player in jail? (boolean)
      jail_rolls = 0), # Number of times a player has rolled while in jail (integer)
    player2 <- data.frame(
      location = 0,
      double_rolls = 0,
      jail = FALSE,
      jail_rolls = 0),
    player3 <- data.frame(
      location = 0,
      double_rolls = 0,
      jail = FALSE,
      jail_rolls = 0),
    player4 <- data.frame(
      location = 0,
      double_rolls = 0,
      jail = FALSE,
      jail_rolls = 0)
  )

  for (i in 1:50) { # Each player has 50 turns
    for (j in 1:4) { # Players take turns in order
      if (players[[j]]$jail == TRUE) { # If the player is in jail...
        d1 = dice_1()
        d2 = dice_2()
        jail_rolls <- jail_rolls + 1
        
        if (d1 == d2 || players[[j]]$jail_rolls == 3) { # If the player rolls doubles or has been in jail for 3 turns, then they get out
          jail = FALSE
          players[[j]]$jail_rolls <- 0
          dice_total <- dice_1() + dice_2()
          players[[j]]$location <- (players[[j]]$location + dice_total) %% 41
          game_board[players[[j]]$location] <- game_board[players[[j]]$location] + 1
        }
        
      } else { # If the player is not in jail...
        d1 = dice_1()
        d2 = dice_2()
        dice_total <- dice_1() + dice_2()
        players[[j]]$location <- (players[[j]]$location + dice_total) %% 41
        game_board[players[[j]]$location] <- game_board[players[[j]]$location] + 1
        
        if (players[[j]]$location == 31) { # Player landed on "Go to jail"
          players[[j]]$location <- 11
          jail = TRUE
        } else if (d1 == d2) { # Player rolled doubles on their first roll
          players[[j]]$double_rolls = players[[j]]$double_rolls + 1
        }
        
        while (players[[j]]$double_rolls > 0 & players[[j]]$double_rolls < 3) { # Player rolls again if they got doubles
          d1 = dice_1()
          d2 = dice_2()
          dice_total <- dice_1() + dice_2()
          players[[j]]$location <- (players[[j]]$location + dice_total) %% 41
          game_board[players[[j]]$location] <- game_board[players[[j]]$location] + 1
          
          if (d1 == d2) { # Increment the player's number of consecutive doubles rolls
            players[[j]]$double_rolls = players[[j]]$double_rolls + 1
          }
        }
        
        if (players[[j]]$double_rolls == 3) { # If player rolls double 3 times in a row, then they go to jail
          players[[j]]$location <- 11
          jail = TRUE
        }
      }
    }  
  }    

  properties <- game_board[c(2, 4, 6, 7, 9, 10, 12, 13, 14, 15, 16, 17, 19, 20, 22, 24, 25, 26, 27, 28, 29, 30, 32, 33, 35, 36, 38, 40)]
  
  property_sum_10games_jail <- property_sum_10games_jail + properties
}  

#assign names to properties
names(property_sum_10games_jail) <- c("Mediterranean Avenue", "Baltic Avenue", "Reading Railroad", "Oriental Avenue", "Vermont Avenue", "Connecticut Avenue", "St. Charles Place", "Electric Company", "States Avenue", "Virginia Avenue", "Pennsylvania Railroad", "St. James Place", "Tennessee Avenue", "New York Avenue", "Kentucky Avenue", "Indiana Avenue", "Illinois Avenue", "B&O Railroad", "Atlantic Avenue", "Ventnor Avenue", "Water Works", "Marvin Gardens", "Pacific Avenue", "North Carolina Avenue", "Pennsylvania Avenue", "Short Line", "Park Place", "Boardwalk")

library(ggplot2)

#data frame with property names and their frequencies
prop_freq2 <- data.frame(
  property = factor(names(property_sum_10games_jail), levels = names(property_sum_10games_jail)),
  frequency = property_sum_10games_jail
)

#plot frequencies in a bar chart
ggplot(prop_freq2, aes(x = property, y = frequency)) +
  geom_bar(stat = "identity", fill = "pink") +
  labs(x = "Index", y = "Frequency", title = "Bar Plot of Property Frequencies\nWith Jail and Doubles Conditions") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


## Section Four
```{r}
# Chance function
chance <- function() {
  card <- sample(1:16, 1) #randomly draw a chance card
  if (card == 1) {
    players[[j]]$location <- 40 # Advance to Boardwalk
  } else if (card == 2) {
    players[[j]]$location <- 1 # Advance to Go
  } else if (card == 3) {
    players[[j]]$location <- 25 # Advance to Illinois Ave
  } else if (card == 4) {
    players[[j]]$location <- 12 # Advance to St. Charles Place
  } else if (card == 5 || card == 6) { # Advance to the nearest railroad
    if (players[[j]]$location == 37) {
      players[[j]]$location <- 6 # Advance to Reading Railroad
    } else if (players[[j]]$location == 8) {
      players[[j]]$location <- 16 # Advance to Pennsylvania Railroad
    } else if (players[[j]]$location == 23) {
      players[[j]]$location <- 26 # Advance to B&O Railroad
    } # Short Line doesn't apply here
  } else if (card == 7) { # Advance to the nearest utility
    if (players[[j]]$location == 8 || players[[j]]$location == 37) {
      players[[j]]$location <- 13 # Advance to Electric Company
    } else if (players[[j]]$location == 23) {
      players[[j]]$location <- 29 # Advance to Water Works
    }
  } else if (card == 8) {
    players[[j]]$location <- players[[j]]$location - 3 # Move backwards 3 places
  } else if (card == 9) {
    players[[j]]$location <- 11 # Go to jail
    players[[j]]$jail == TRUE
  } else if (card == 10) {
    players[[j]]$location <- 6 # Advance to Reading Railroad
  } 
 }

# Simulation with the chance function and jail conditions
property_sum_10games_chance <- c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0) #vector to store property landing totals

for (game in 1:10) {
  #initialize game board with 41 spaces that all start with 0 times they have been landed on
  game_board <- c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)

  #initialize each player
  players <- list(
    player1 <- data.frame(
      location = 0, #starting location
      double_rolls = 0, #number of times doubles has been rolled
      jail = FALSE, #player does not start in jail
      jail_rolls = 0), #number of times player has rolled dice while in jail
    player2 <- data.frame(
      location = 0,
      double_rolls = 0,
      jail = FALSE,
      jail_rolls = 0),
    player3 <- data.frame(
      location = 0,
      double_rolls = 0,
      jail = FALSE,
      jail_rolls = 0),
    player4 <- data.frame(
      location = 0,
      double_rolls = 0,
      jail = FALSE,
      jail_rolls = 0)
  )

  #simulate 50 turns in each game
  for (i in 1:50) {
    for (j in 1:4) {
      #checks if player is in jail
      if (players[[j]]$jail == TRUE) {
        d1 = dice_1()
        d2 = dice_2()
        jail_rolls <- jail_rolls + 1

        #get out of jail by rolling doubles or after 3 attempts at rolling doubles
        if (d1 == d2 || players[[j]]$jail_rolls == 3) {
          jail = FALSE #leaves jail
          players[[j]]$jail_rolls <- 0 #return jail rolls to 0
          dice_total <- dice_1() + dice_2() #move after leaving jail
          players[[j]]$location <- (players[[j]]$location + dice_total) %% 41

          #land on chance space draw a chance card
          if (players[[j]]$location == 8 || players[[j]]$location == 23 || players[[j]]$location == 37) {
            game_board[players[[j]]$location] <- game_board[players[[j]]$location] + 1
            chance()
          }
          #record space being landed on
          game_board[players[[j]]$location] <- game_board[players[[j]]$location] + 1
        }
        
      } else {
        #non-jail movements
        d1 = dice_1()
        d2 = dice_2()
        dice_total <- dice_1() + dice_2()
        players[[j]]$location <- (players[[j]]$location + dice_total) %% 41

        #check for landing on a chance space
        if (players[[j]]$location == 8 || players[[j]]$location == 23 || players[[j]]$location == 37) {
            game_board[players[[j]]$location] <- game_board[players[[j]]$location] + 1
            chance()
          }
        #record space being landed on
        game_board[players[[j]]$location] <- game_board[players[[j]]$location] + 1

        #landing on Go to Jail space
        if (players[[j]]$location == 31) {
          players[[j]]$location <- 11 #change player location to jail
          jail = TRUE #change jail element to true
        } else if (d1 == d2) {
          players[[j]]$double_rolls = players[[j]]$double_rolls + 1 #track how many times doubles have been rolled
        }

        #give extra turn when doubles rolled; up to 3 times
        while (players[[j]]$double_rolls > 0 & players[[j]]$double_rolls < 3) {
          d1 = dice_1()
          d2 = dice_2()
          dice_total <- dice_1() + dice_2()
          players[[j]]$location <- (players[[j]]$location + dice_total) %% 41

          #check for landing on a chance space
          if (players[[j]]$location == 8 || players[[j]]$location == 23 || players[[j]]$location == 37) {
            game_board[players[[j]]$location] <- game_board[players[[j]]$location] + 1
            chance()
          }
          game_board[players[[j]]$location] <- game_board[players[[j]]$location] + 1
          
          if (d1 == d2) {
            players[[j]]$double_rolls = players[[j]]$double_rolls + 1
          }
        }

        #after rolling doubles 3 times go to jail
        if (players[[j]]$double_rolls == 3) {
          players[[j]]$location <- 11
          jail = TRUE
        }
      }
    }  
  }    

  #track landing frequencies for property spaces
  properties <- game_board[c(2, 4, 6, 7, 9, 10, 12, 13, 14, 15, 16, 17, 19, 20, 22, 24, 25, 26, 27, 28, 29, 30, 32, 33, 35, 36, 38, 40)]

  #add simulated game to the total
  property_sum_10games_chance <- property_sum_10games_chance + properties
}  

#assign names to properties
names(property_sum_10games_chance) <- c("Mediterranean Avenue", "Baltic Avenue", "Reading Railroad", "Oriental Avenue", "Vermont Avenue", "Connecticut Avenue", "St. Charles Place", "Electric Company", "States Avenue", "Virginia Avenue", "Pennsylvania Railroad", "St. James Place", "Tennessee Avenue", "New York Avenue", "Kentucky Avenue", "Indiana Avenue", "Illinois Avenue", "B&O Railroad", "Atlantic Avenue", "Ventnor Avenue", "Water Works", "Marvin Gardens", "Pacific Avenue", "North Carolina Avenue", "Pennsylvania Avenue", "Short Line", "Park Place", "Boardwalk")

library(ggplot2)

#data frame with property names and their frequencies
prop_freq2 <- data.frame(
  property = factor(names(property_sum_10games_chance), levels = names(property_sum_10games_chance)),
  frequency = property_sum_10games_chance
)

#plot frequencies in a bar chart
ggplot(prop_freq2, aes(x = property, y = frequency)) +
  geom_bar(stat = "identity", fill = "maroon") +
  labs(x = "Index", y = "Frequency", title = "Bar Plot of Property Frequencies\nWith Jail, Doubles Conditions, and\nChance Movement Cards") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### Section Five
```{r}
# Function to simulate a game
play_game <- function(use_free_parking_rule = FALSE) {

  wrap_position <- function(pos) {
    if ((pos %% 40) == 0) 40 else pos %% 40
  }

  game_board <- rep(0, 41)
  free_parking_pot <- 0
  
  ownable_positions <- c(1, 3, 5, 6, 8, 9, 11, 12, 13, 14, 15, 16, 18, 19, 21, 23, 24,
                         25, 26, 27, 28, 29, 31, 32, 34, 35, 37, 39)
  ownership <- rep(NA, 41)

  # Randomly assign 7 properties per player
  all_props <- sample(ownable_positions)
  for (i in 1:4) {
    for (p in all_props[((i - 1) * 7 + 1):(i * 7)]) {
      ownership[p] <- i
    }
  }

  # Initialize players as lists
  players <- list()
  for (i in 1:4) {
    players[[i]] <- list(
      location = 1,
      double_rolls = 0,
      jail = FALSE,
      jail_rolls = 0,
      account = 100,
      get_out_of_jail_free = FALSE,
      active = TRUE
    )
  }

  property_rent_df <- data.frame(
    position = ownable_positions,
    rent = c(2, 4, 25, 6, 6, 8, 10, 10, 12, 14, 14, 16,
             18, 18, 20, 22, 22, 25, 26, 26, 28, 28,
             0, 30, 32, 35, 50, 50)
  )

  rent_table <- rep(0, 41)
  rent_table[property_rent_df$position] <- property_rent_df$rent

  dice_1 <- function() sample(1:6, 1)
  dice_2 <- function() sample(1:6, 1)

  # Chance card effect
  chance <- function(j, players, free_parking_pot) {
    card <- sample(1:16, 1)
    if (card == 1) players[[j]]$location <- 40
    else if (card == 2) {
      players[[j]]$location <- 1
      players[[j]]$account <- players[[j]]$account + 200
    } else if (card == 3) players[[j]]$location <- 25
    else if (card == 4) players[[j]]$location <- 12
    else if (card %in% c(5, 6)) {
      if (players[[j]]$location == 37) {
        players[[j]]$location <- 6
        players[[j]]$account <- players[[j]]$account + 200
      } else if (players[[j]]$location == 8) {
        players[[j]]$location <- 16
      } else if (players[[j]]$location == 23) {
        players[[j]]$location <- 26
      }
    } else if (card == 7) players[[j]]$location <- 13
    else if (card == 8) players[[j]]$location <- wrap_position(players[[j]]$location - 3)
    else if (card == 9) {
      players[[j]]$location <- 11
      players[[j]]$jail <- TRUE
    } else if (card == 10) {
      players[[j]]$location <- 6
      players[[j]]$account <- players[[j]]$account + 200
    } else if (card == 11) players[[j]]$account <- players[[j]]$account + 50
    else if (card == 12) players[[j]]$get_out_of_jail_free <- TRUE
    else if (card == 13) {
      players[[j]]$account <- players[[j]]$account - 15
      if (use_free_parking_rule) free_parking_pot <- free_parking_pot + 15
    } else if (card == 14) {
      for (k in 1:4) {
        if (k != j && players[[k]]$active) {
          players[[k]]$account <- players[[k]]$account - 50
          players[[j]]$account <- players[[j]]$account + 50
        }
      }
    } else if (card == 15) players[[j]]$account <- players[[j]]$account + 150
    return(list(players = players, free_parking_pot = free_parking_pot))
  }

  # Community Chest
  community_chest <- function(j, players, free_parking_pot) {
    card <- sample(1:16, 1)
    if (card == 1) {
      players[[j]]$location <- 1
      players[[j]]$account <- players[[j]]$account + 200
    } else if (card == 2) players[[j]]$account <- players[[j]]$account + 200
    else if (card == 3) {
      players[[j]]$account <- players[[j]]$account - 50
      if (use_free_parking_rule) free_parking_pot <- free_parking_pot + 50
    } else if (card == 4) players[[j]]$account <- players[[j]]$account + 50
    else if (card == 5) players[[j]]$account <- players[[j]]$account + 100
    else if (card == 6) {
      players[[j]]$account <- players[[j]]$account - 100
      if (use_free_parking_rule) free_parking_pot <- free_parking_pot + 100
    } else if (card == 7) {
      players[[j]]$location <- 11
      players[[j]]$jail <- TRUE
    } else if (card == 8) players[[j]]$get_out_of_jail_free <- TRUE
    else if (card == 9) players[[j]]$account <- players[[j]]$account + 25
    else if (card == 10) {
      players[[j]]$account <- players[[j]]$account - 15
      if (use_free_parking_rule) free_parking_pot <- free_parking_pot + 15
    }
    return(list(players = players, free_parking_pot = free_parking_pot))
  }

  round_count <- 0
  repeat {
    round_count <- round_count + 1
    active_players <- which(sapply(players, function(p) p$active))

    if (length(active_players) == 1) {
      return(round_count)
    }

    for (j in active_players) {
      if (!players[[j]]$active) next

      if (players[[j]]$jail) {
        d1 <- dice_1(); d2 <- dice_2()
        players[[j]]$jail_rolls <- players[[j]]$jail_rolls + 1
        if (d1 == d2 || players[[j]]$jail_rolls == 3) {
          players[[j]]$jail <- FALSE
          players[[j]]$jail_rolls <- 0
          move <- d1 + d2
          players[[j]]$location <- wrap_position(players[[j]]$location + move)
        } else {
          next
        }
      } else {
        d1 <- dice_1(); d2 <- dice_2()
        move <- d1 + d2
        players[[j]]$location <- wrap_position(players[[j]]$location + move)

        players[[j]]$double_rolls <- ifelse(d1 == d2, players[[j]]$double_rolls + 1, 0)
        if (players[[j]]$double_rolls == 3) {
          players[[j]]$location <- 11
          players[[j]]$jail <- TRUE
          players[[j]]$double_rolls <- 0
          next
        }
      }

      loc <- players[[j]]$location

      if (loc %in% c(8, 23, 37)) {
        result <- chance(j, players, free_parking_pot)
        players <- result$players
        free_parking_pot <- result$free_parking_pot
        loc <- players[[j]]$location
      }

      if (loc %in% c(2, 17, 33)) {
        result <- community_chest(j, players, free_parking_pot)
        players <- result$players
        free_parking_pot <- result$free_parking_pot
        loc <- players[[j]]$location
      }

      if (use_free_parking_rule && loc == 20) {
        players[[j]]$account <- players[[j]]$account + free_parking_pot
        free_parking_pot <- 0
      }

      if (loc == 31) {
        players[[j]]$location <- 11
        players[[j]]$jail <- TRUE
        next
      }

      if (!is.na(ownership[loc]) && ownership[loc] != j && players[[ownership[loc]]]$active) {
        rent <- rent_table[loc]
        players[[j]]$account <- players[[j]]$account - rent
        players[[ownership[loc]]]$account <- players[[ownership[loc]]]$account + rent
      }

      if (players[[j]]$account < 0) {
        players[[j]]$active <- FALSE
        bankrupt_props <- which(ownership == j)
        ownership[bankrupt_props] <- NA
        rent_table[bankrupt_props] <- 0
      }
    }
  }
}

# Simulate 10 games
games_fp <- replicate(2, play_game(TRUE))
games_nofp <- replicate(2, play_game(FALSE))

cat("With Free Parking: Avg Rounds:", mean(games_fp), "\n")
cat("Without Free Parking:", mean(games_nofp), "\n")
```
```{r}
# Community Chest Cards Function
chest <- function() {
  chest_card <- sample(1:16, 1)
    if (chest_card == 1) {
      players[[j]]$location <- 1 # Advance to Go (Collect $200)
      players[[j]]$account <- players[[j]]$account + 200
    } else if (chest_card == 2) {
      players[[j]]$account <- players[[j]]$account + 200 # Bank error in your favor. Collect $200
    } else if (chest_card == 3) {
      players[[j]]$account <- players[[j]]$account - 50 # Doctorâ€™s fee. Pay $50
      free_parking_fund <- free_parking_fund + 50
    } else if (chest_card == 4) {
      players[[j]]$account <- players[[j]]$money + 50 # From sale of stock you get $50
    } else if (chest_card == 5) {
      players[[j]]$get_out_of_jail_free <- TRUE # Get Out of Jail Free
    } else if (chest_card == 6) {
      players[[j]]$jail <- TRUE # Go to Jail. Go directly to jail, do not pass Go, do not collect $200
    } else if (chest_card == 7) {
      players[[j]]$account <- players[[j]]$account + 100 # Holiday fund matures. Receive $100
    } else if (chest_card == 8) {
      players[[j]]$account <- players[[j]]$account + 20 # Income tax refund. Collect $20
    } else if (chest_card == 9) {
      players[[j]]$account <- players[[j]]$account + 10 * 3 # It is your birthday. Collect $10 from every player
        for (k in 1:4) {
          if (k != j) {
            players[[k]]$account <- players[[k]]$account - 10
        }
      }
    } else if (chest_card == 10) {
      players[[j]]$account <- players[[j]]$account + 100 # Life insurance matures. Collect $100
    } else if (chest_card == 11) {
      players[[j]]$account <- players[[j]]$account - 100 # Pay hospital fees of $100
      free_parking_fund <- free_parking_fund + 100
    } else if (chest_card == 12) {
      players[[j]]$account <- players[[j]]$account - 50 # Pay school fees of $50
      free_parking_fund <- free_parking_fund + 50
    } else if (chest_card == 13) {
      players[[j]]$account <- players[[j]]$account - 25 # Receive $25 consultancy fee
      free_parking_fund <- free_parking_fund + 25
    } else if (chest_card == 14) {
      players[[j]]$account <- players[[j]]$account + 10 # You have won second prize in a beauty contest. Collect $10
    } else if (chest_card == 15) {
      players[[j]]$account <- players[[j]]$account + 100 # You inherit $100
    }
      # Card 16 is paying for houses and hotels -- doesn't apply here
}

free_parking_fund <- 0

free_parking <- function(){
  if (players[[j]]$location == 20) {  # Free Parking position
  players[[j]]$account <- players[[j]]$account + free_parking_fund
  free_parking_fund <- 0  # Reset the fund
  }
}
```
### Chance function
```{r}
chance <- function() {
  card <- sample(1:16, 1)
  old_location <- players[[j]]$location
  new_location <- players[[j]]$location
   if (card == 1) {
    players[[j]]$location <- 40 # Advance to Boardwalk
    new_location <- players[[j]]$location
  } else if (card == 2) {
    players[[j]]$location <- 1 # Advance to Go
    new_location <- players[[j]]$location
  } else if (card == 3) {
    players[[j]]$location <- 25 # Advance to Illinois Ave
    new_location <- players[[j]]$location
  } else if (card == 4) {
    players[[j]]$location <- 12 # Advance to St. Charles Place
    new_location <- players[[j]]$location
  } else if (card == 5 || card == 6) { # Advance to the nearest railroad
    if (players[[j]]$location == 37) {
      players[[j]]$location <- 6 # Advance to Reading Railroad
      new_location <- players[[j]]$location
    } else if (players[[j]]$location == 8) {
      players[[j]]$location <- 16 # Advance to Pennsylvania Railroad
      new_location <- players[[j]]$location
    } else if (players[[j]]$location == 23) {
      players[[j]]$location <- 26 # Advance to B&O Railroad
      new_location <- players[[j]]$location
    } 
  } else if (card == 7) { # Advance to the nearest utility
    if (players[[j]]$location == 8 || players[[j]]$location == 37) {
      players[[j]]$location <- 13 # Advance to Electric Company
      new_location <- players[[j]]$location
    } else if (players[[j]]$location == 23) {
      players[[j]]$location <- 29 # Advance to Water Works
      new_location <- players[[j]]$location
    }
  } else if (card == 8) {
    players[[j]]$location <- players[[j]]$location - 3 # Move backwards 3 places
    if (players[[j]]$location == 1) {
        players[[j]]$account <- players[[j]]$account + 200 # If landed on GO collect $200
      }
    new_location <- players[[j]]$location
  } else if (card == 9) {
    players[[j]]$location <- 11 # Go to jail
    players[[j]]$jail <- TRUE
    new_location <- players[[j]]$location
  } else if (card == 10) {
    players[[j]]$location <- 6 # Advance to Reading Railroad
    new_location <- players[[j]]$location
  } 

  if (new_location < old_location && card %in% c(1, 3:7, 10)) {
    players[[j]]$account <- players[[j]]$account + 200 # Passing Go for cards 1, 3-7, and 10
  }
  
    else if (card == 11) {
      players[[j]]$account <- players[[j]]$account + 50 # Bank pays you $50
    }
    else if (card == 12) {
      players[[j]]$get_out_of_jail_free == TRUE # Get out of jail free card
    }
    else if (card == 13) {
      players[[j]]$account <- players[[j]]$account - 15 # Speeding fine $15
      free_parking_fund <- free_parking_fund + 15
    }
    else if (card == 14) {
      players[[j]]$account <- players[[j]]$account - 50 * 3
        for (k in 1:4) {
          if (k != j) {
            players[[k]]$account <- players[[k]]$account + 50 # Elected Chairman of the Board; pay each player $50
          }
        }
    }
    else if (card == 15) {
      players[[j]]$account <- players[[j]]$account + 150 # Building loan matures; collect $150
      
      # Card 16 is paying for houses and hotels -- doesn't apply here
    }
}
```

### Chance function - Lucy
```{r}
chance <- function() {
  card <- sample(1:16, 1)
  if (card == 1) {
    players[[j]]$location <- 40 # Advance to Boardwalk
  } else if (card == 2) {
    players[[j]]$location <- 1 # Advance to Go
    players[[j]]$account <- players[[j]]$account + 200
  } else if (card == 3) {
    players[[j]]$location <- 25 # Advance to Illinois Ave
    if (players[[j]]$location == 37) {
      players[[j]]$account <- players[[j]]$account + 200
    }
  } else if (card == 4) {
    players[[j]]$location <- 12 # Advance to St. Charles Place
    if (players[[j]]$location != 8) {
      players[[j]]$account <- players[[j]]$account + 200
    }
  } else if (card == 5 || card == 6) { # Advance to the nearest railroad
    if (players[[j]]$location == 37) {
      players[[j]]$location <- 6 # Advance to Reading Railroad
      players[[j]]$account <- players[[j]]$account + 200
    } else if (players[[j]]$location == 8) {
      players[[j]]$location <- 16 # Advance to Pennsylvania Railroad
    } else if (players[[j]]$location == 23) {
      players[[j]]$location <- 26 # Advance to B&O Railroad
    } 
  } else if (card == 7) { # Advance to the nearest utility
    if (players[[j]]$location == 8 || players[[j]]$location == 37) {
      players[[j]]$location <- 13 # Advance to Electric Company
      if (players[[j]]$location == 37) {
      players[[j]]$account <- players[[j]]$account + 200
    }
    } else if (players[[j]]$location == 23) {
      players[[j]]$location <- 29 # Advance to Water Works
    }
  } else if (card == 8) {
    players[[j]]$location <- players[[j]]$location - 3 # Move backwards 3 places
  } else if (card == 9) {
    players[[j]]$location <- 11 # Go to jail
    players[[j]]$jail <- TRUE
  } else if (card == 10) {
    players[[j]]$location <- 6 # Advance to Reading Railroad
    players[[j]]$account <- players[[j]]$account + 200
  } else if (card == 11) { # Bank pays you $50
    players[[j]]$account <- players[[j]]$account + 50
  } else if (card == 12) { # Get out of jail free
    players[[j]]$get_out_of_jail_free = TRUE
  } else if (card == 13) { # Speeding fine
    players[[j]]$account <- players[[j]]$account - 15
  } else if (card == 14) { # Elected chairman
    players[[j]]$account <- players[[j]]$account + 150
    for (k in 1:4) {
      if (players[[j]] != players[[k]]) {
        players[[k]]$account <- players[[k]]$account - 50
      }
    }
  } else if (card == 15) { # Building loan matures
    players[[j]]$account <- players[[j]]$account + 150
  }
}
```

### Divide up properties
```{r}
#This function will divide all the properties between the four players
#Input: properties vector
#Return: Four equal groups of randomly shuffled elements from the properties vector

divide_properties <- function(x) {
  shuffled <- sample(x) #randomly shuffles all the elements of the properties vector
  n <- length(shuffled) #length of shuffled vector
  indices <- rep(1:4, times = 7) #creates a vector that contains a repeating sequence from 1 to 4 that is 28 elements long
  result <- split(shuffled, indices) #splits shuffled vector into four groups
}
```

### Function determines ownership of a property when it is landed on
```{r}
#This function will determine the ownership of a property when it is landed on
ownership <- function(x) {
  for (p in players) {
    for (i in 1:7) {
      if (x == players[[p]]$owned_properties[i]) {
        if (p == players[[p]]$ID) {
          return(NULL)
        } else {
          return(players[[p]])
        }
      }
    }
  }
}
```

### Determines rent for railroads and utilities
```{r}
#This function will calculate fees owed on special properties (railroads and utilities)
#Input: a vector of integers with each integer corresponding to a property on the board
#Return: a vector of fees owed
special_ownership <- function(x) {
  rail_count <- 0 #initialize number of railroad properties held to zero
  util_count <- 0 #initialize number of utility properties held to zero
  for (i in 1:7) {
    #check if property is a railroad (positions 6, 16, 26 and 36)
    if (x[i] == 6 || x[i] == 16 || x[i] == 26 || x[i] == 36) {
      rail_count <- rail_count + 1 #add one to railroad count vector
    #check if property is a utility (positions 13 and 29)
    } else if (x[i] == 13 || x[i] == 29) {
      util_count = util_count + 1 #add one to utility count vector
    }
  }
  
  fees <- c() #this vector will hold the fee values

  #determine fee owed based on number railroad cards owned 
  if (rail_count == 0) {
    fees <- append(fees, 0) #add 0 to fees vector
  } else if (rail_count == 1) {
    fees <- append(fees, 25) #add 25 to fees vector
  } else if (rail_count == 2) {
    fees <- append(fees, 50) #add 50 to fees vector
  } else {
    fees <- append(fees, 100) #add 100 to fees vector
  }

  #determine fee owed based on number utility cards owned 
  if (util_count == 0) {
    fees <- append(fees, 0) #add 0 to fees vector
  } else if (util_count == 1) {
    fees <- append(fees, 4) #add 4 to fees vector
  } else {
    fees <- append(fees, 10) #add 10 to fees vector
  } 
  
  return(fees) #vector of fees owed
}
```

### Function to collect/pay rent and get money for passing go
```{r}
#This function facilitates rent transactions between players
#Input: a numeric value that corresponds to a position on the board that the player has moved to
#Return: modifies player accounts in the player list
rent <- function(x) {
  if (x == 1) { # Go position
    players[[j]]$account = players[[j]]$account + 200 #player money +200
  } else if (x == 5) { # Income tax position
    players[[j]]$account = players[[j]]$account - 200 #player money -200
  } else if (x == 39) { # Luxury tax position
    players[[j]]$account = players[[j]]$account - 100
  }
  
  owner <- ownership(x)
  if (owner$in_game == TRUE) {
    if (x == 2) { # Mediterranean Ave
      players[[j]]$account = players[[j]]$account - 2
      owner$account = owner$account + 2
    } else if (x == 4) { # Baltic Ave
      players[[j]]$account = players[[j]]$account - 4
      owner$account = owner$account + 4
    } else if (x == 6 || x == 16 || x == 26 || x == 36) { # Railroads
      special_fees <- owner$rails_and_utils
      players[[j]]$account = players[[j]]$account - special_fees[1]
      owner$account = owner$account + special_fees[1]
    } else if (x == 7) { # Oriental Ave
      players[[j]]$account = players[[j]]$account - 6
      owner$account = owner$account + 6
    } else if (x == 9) { # Vermont Ave
      players[[j]]$account = players[[j]]$account - 6
      owner$account = owner$account + 6
    } else if (x == 10) { # Connecticut Ave
      players[[j]]$account = players[[j]]$account - 8
      owner$account = owner$account + 8
    } else if (x == 12) { # St. Charles Place
      players[[j]]$account = players[[j]]$account - 10
      owner$account = owner$account + 10
    } else if (x == 13 || x == 29) { # Utilities
      special_fees <- owner$rails_and_utils
      players[[j]]$account = players[[j]]$account - special_fees[2]
      owner$account = owner$account + special_fees[2]
    } else if (x == 14) { # States Ave
      players[[j]]$account = players[[j]]$account - 10
      owner$account = owner$account + 10
    } else if (x == 15) { # Virginia Ave
      players[[j]]$account = players[[j]]$account - 12
      owner$account = owner$account + 12
    } else if (x == 17) { # St. James Place
      players[[j]]$account = players[[j]]$account - 14
      owner$account = owner$account + 14
    } else if (x == 19) { # Tennessee Ave
      players[[j]]$account = players[[j]]$account - 14
      owner$account = owner$account + 14
    } else if (x == 20) { # New York Ave
      players[[j]]$account = players[[j]]$account - 16
      owner$account = owner$account + 16
    } else if (x == 22) { # Kentucky Ave
      players[[j]]$account = players[[j]]$account - 18
      owner$account = owner$account + 18
    } else if (x == 24) { # Indiana Ave
      players[[j]]$account = players[[j]]$account - 18
      owner$account = owner$account + 18
    } else if (x == 25) { # Illinois Ave
      players[[j]]$account = players[[j]]$account - 20
      owner$account = owner$account + 20
    } else if (x == 27) { # Atlantic Ave
      players[[j]]$account = players[[j]]$account - 22
      owner$account = owner$account + 22
    } else if (x == 28) { # Vetnor Ave
      players[[j]]$account = players[[j]]$account - 22
      owner$account = owner$account + 22
    } else if (x == 30) { # Marvin Gardens
      players[[j]]$account = players[[j]]$account - 24
      owner$account = owner$account + 24
    } else if (x == 32) { # Pacific Ave
      players[[j]]$account = players[[j]]$account - 26
      owner$account = owner$account + 26
    } else if (x == 33) { # North Carolina Ave
      players[[j]]$account = players[[j]]$account - 26
      owner$account = owner$account + 26
    } else if (x == 35) { # Pennsylvania Ave
      players[[j]]$account = players[[j]]$account - 28
      owner$account = owner$account + 28
    } else if (x == 38) { # Park Place
      players[[j]]$account = players[[j]]$account - 35
      owner$account = owner$account + 35
    } else if (x == 40) { # Boardwalk
      players[[j]]$account = players[[j]]$account - 50
      owner$account = owner$account + 50
    }
  }
}
```

### INCOMPLETE!!!!! Full simulation of a game
```{r}
properties <- c(2, 4, 6, 7, 9, 10, 12, 13, 14, 15, 16, 17, 19, 20, 22, 24, 25, 26, 27, 28, 29, 30, 32, 33, 35, 36, 38, 40)

# Randomly give each player 7 properties
property_groups <- divide_properties(properties)

# Add location of properties to players owned properties vector
players <- list(
  player1 <- list(
    ID = 1,
    location = 0,
    double_rolls = 0,
    jail = FALSE,
    jail_rolls = 0,
    account = 1500,
    owned_properties <- property_groups[1],
    rails_and_utils <- special_ownership(unlist(owned_properties)),
    get_out_of_jail_free = FALSE,
    in_game = TRUE),
  player2 <- list(
    ID = 2,
    location = 0,
    double_rolls = 0,
    jail = FALSE,
    jail_rolls = 0,
    account = 1500,
    owned_properties <- property_groups[2],
    rails_and_utils <- special_ownership(unlist(owned_properties)),
    get_out_of_jail_free = FALSE,
    in_game = TRUE),
  player3 <- list(
    ID = 3,
    location = 0,
    double_rolls = 0,
    jail = FALSE,
    jail_rolls = 0,
    account = 1500,
    owned_properties <- property_groups[3],
    rails_and_utils <- special_ownership(unlist(owned_properties)),
    get_out_of_jail_free = FALSE,
    in_game = TRUE),
  player4 <- list(
    ID = 4,
    location = 0,
    double_rolls = 0,
    jail = FALSE,
    jail_rolls = 0,
    account = 1500,
    owned_properties <- property_groups[4],
    rails_and_utils <- special_ownership(unlist(owned_properties)),
    get_out_of_jail_free = FALSE,
    in_game = TRUE)
  )

# Make attribute to know how many players are still in
players_in <- 4
# Make attribute to count the number of turns taken
total_turns <- 0

while (players_in > 1) {
  # Add rent function to this whole thing
  for (j in 1:4) {
    if (players[[j]]$in_game == TRUE) {
      if (players[[j]]$jail == TRUE & players[[j]]$get_out_of_jail_free == FALSE) {
        d1 = dice_1()
        d2 = dice_2()
        jail_rolls <- jail_rolls + 1
        
        if (d1 == d2 || players[[j]]$jail_rolls == 3) {
          jail = FALSE
          players[[j]]$jail_rolls <- 0
          dice_total <- dice_1() + dice_2()
          players[[j]]$location <- (players[[j]]$location + dice_total) %% 41
          if (players[[j]]$location == 8 || players[[j]]$location == 23 || players[[j]]$location == 37) {
            chance()
          }
          # Add community chest
          if (players[[j]]$location == 3 || players[[j]]$location == 18 || players[[j]]$location == 34) {
            chest()
          }
          # Pay rent
          rent(players[[j]]$location)
        }
        total_turns = total_turns + 1
        
      } else {
        if (players[[j]]$jail == TRUE & players[[j]]$get_out_of_jail_free == TRUE) {
          players[[j]]$jail == FALSE
          players[[j]]$get_out_of_jail_free == FALSE
        }
        d1 = dice_1()
        d2 = dice_2()
        dice_total <- dice_1() + dice_2()
        players[[j]]$location <- (players[[j]]$location + dice_total) %% 41
        if (players[[j]]$location == 8 || players[[j]]$location == 23 || players[[j]]$location == 37) {
            chance()
        }
        if (players[[j]]$location == 3 || players[[j]]$location == 18 || players[[j]]$location == 34) {
            chest()
          }
          # Pay rent
          rent(players[[j]]$location)
      }
        
      if (players[[j]]$location == 31) {
        players[[j]]$location <- 11
        jail = TRUE
      } else if (d1 == d2) {
        players[[j]]$double_rolls = players[[j]]$double_rolls + 1
      }
        
      while (players[[j]]$double_rolls > 0 & players[[j]]$double_rolls < 3) {
        d1 = dice_1()
        d2 = dice_2()
        dice_total <- dice_1() + dice_2()
        players[[j]]$location <- (players[[j]]$location + dice_total) %% 41
        if (players[[j]]$location == 8 || players[[j]]$location == 23 || players[[j]]$location == 37) {
          chance()
        }
        # Add community chest
        if (players[[j]]$location == 3 || players[[j]]$location == 18 || players[[j]]$location == 34) {
          chest()
        }
        # Pay rent
        rent(players[[j]]$location)
      }
          
      if (d1 == d2) {
        players[[j]]$double_rolls = players[[j]]$double_rolls + 1
      }
      
      if (players[[j]]$double_rolls == 3) {
        players[[j]]$location <- 11
        jail = TRUE
      }
      
      if (players[[j]]$account < 0) {
        players[[j]]$in_game = FALSE
        players_in = players_in - 1
      }
      
      total_turns = total_turns + 1
    }
  }
}

```

```{r}
get_active_players <- function(players) {
  return(which(sapply(players, function(p) p$in_game)))
}

turn_counter <- 0 # put before game loop 

turn_counter <- turn_counter + 1 # put inside the for (j in 1:4) loop, after each player's turn

# At end of game loop, after while loop finishes 
remaining_players <- get_active_players(players)

if (length(remaining_players) == 1) {
  winner <- players[[remaining_players]]
  
  cat("\n GAME OVER! \n")
  cat("---------------------\n")
  cat("Winner Player ID:", winner$ID, "\n")
  cat("Number of Turns:", turn_counter, "\n")
  cat("Final Money Amount:", winner$account, "\n")
  cat("---------------------\n")
}
```
